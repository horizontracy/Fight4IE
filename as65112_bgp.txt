as65112_bgp
[r2-r3][r20]

[r2]
＃r2有5个vrf口
ip vrf GREEN
rd 12:12
route-target 12:12
exit
ip vrf BLUE
rd 13:13
route-target 13:13
exit
ip vrf RED
rd 14:14
route-target 14:14
exit
ip vrf YELLOW
rd 15:15
route-target 15:15
exit
ip vrf INET
rd 99:99
route-target 99:99
exit

＃5个vrf口朝向r20
int e1/0
not shutdown
exit
int e1/0.12
encap dot 12
ip address 10.201.12.1 255.255.255.252
ip vrf forwarding GREEN
exit
int e1/0.13
encap dot 13
ip address 10.201.13.1 255.255.255.252
ip vrf forwarding BLUE
exit
int e1/0.14
encap dot 14
ip address 10.201.14.1 255.255.255.252
ip vrf forwarding RED
exit
int e1/0.15
encap dot 15
ip address 10.201.15.1 255.255.255.252
ip vrf forwarding YELLOW
exit
int e1/0.99
encap dot 99
ip address 10.201.99.1 255.255.255.252
ip vrf forwarding INET
exit

router bgp 12345
no bgp default ipv4-unicast
bgp router-id 123.2.2.2

neighbor 10.201.12.2 remote-as 65112
neighbor 10.201.13.2 remote-as 65112
neighbor 10.201.14.2 remote-as 65112
neighbor 10.201.15.2 remote-as 65112
neighbor 10.201.99.2 remote-as 65112

address-family ipv4 vrf GREEN
neighbor 10.201.12.2 activate
exit
address-family ipv4 vrf BLUE
neighbor 10.201.13.2 activate
exit
address-family ipv4 vrf RED
neighbor 10.201.14.2 activate
exit
address-family ipv4 vrf YELLOW
neighbor 10.201.15.2 activate
exit
address-family ipv4 vrf INET
neighbor 10.201.99.2 activate
exit

exit

[r3]

[r20]
int e1/0
no shutdown
exit
int e1/0.12
encap dot 12
ip address 10.201.12.2 255.255.255.252
ip vrf forwarding GREEN
exit
int e1/0.13
encap dot 13
ip address 10.201.13.2 255.255.255.252
ip vrf forwarding BLUE
exit
int e1/0.14
encap dot 14
ip address 10.201.14.2 255.255.255.252
ip vrf forwarding RED
exit
int e1/0.15
encap dot 15
ip address 10.201.15.2 255.255.255.252
ip vrf forwarding YELLOW
exit
int e1/0.99
encap dot 99
ip address 10.201.99.2 255.255.255.252
ip vrf forwarding INET
exit

int e1/1
no shutdown
exit
int e1/1.12
encap dot 12
ip address 10.201.12.6 255.255.255.252
ip vrf forwarding GREEN
exit
int e1/1.13
encap dot 13
ip address 10.201.13.6 255.255.255.252
ip vrf forwarding BLUE
exit
int e1/1.14
encap dot 14
ip address 10.201.14.6 255.255.255.252
ip vrf forwarding RED
exit
int e1/1.15
encap dot 15
ip address 10.201.15.6 255.255.255.252
ip vrf forwarding YELLOW
exit
int e1/1.99
encap dot 99
ip address 10.201.99.6 255.255.255.252
ip vrf forwarding INET
exit

router bgp 65112
no bgp default ipv4-unicast
bgp router-id 123.20.20.20

neighbor 10.201.12.1 remote-as 12345
neighbor 10.201.13.1 remote-as 12345
neighbor 10.201.14.1 remote-as 12345
neighbor 10.201.15.1 remote-as 12345
neighbor 10.201.99.1 remote-as 12345
neighbor 10.201.12.5 remote-as 12345
neighbor 10.201.13.5 remote-as 12345
neighbor 10.201.14.5 remote-as 12345
neighbor 10.201.15.5 remote-as 12345
neighbor 10.201.99.5 remote-as 12345

＃r20通过全局ipv4多bgp和r2建立邻居
address-family ipv4
neighbor 10.201.12.1 activate
neighbor 10.201.13.1 activate
neighbor 10.201.14.1 activate
neighbor 10.201.15.1 activate
neighbor 10.201.99.1 activate
neighbor 10.201.12.5 activate
neighbor 10.201.13.5 activate
neighbor 10.201.14.5 activate
neighbor 10.201.15.5 activate
neighbor 10.201.99.5 activate
neighbor 10.201.12.1 default-originate
neighbor 10.201.13.1 default-originate
neighbor 10.201.14.1 default-originate
neighbor 10.201.15.1 default-originate
neighbor 10.201.12.5 default-originate
neighbor 10.201.13.5 default-originate
neighbor 10.201.14.5 default-originate
neighbor 10.201.15.5 default-originate

network 10.20.1.1 mask 255.255.255.255
network 10.20.2.1 mask 255.255.255.255
network 123.20.20.20 mask 255.255.255.255

＃r20只向bgp邻居通告10.0.0.0/8和123.0.0.0/8的汇总路由
aggregate-address 123.0.0.0 255.0.0.0 summary-only
aggregate-address 10.0.0.0 255.0.0.0 summary-only

exit

exit

